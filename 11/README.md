## Домашнее задание к занятию «Компоненты Kubernetes»

Рассчитать требования к кластеру под проект

Известно, что проекту нужны база данных, система кеширования, а само приложение состоит из бекенда и фронтенда. Опишите, какие ресурсы нужны, если известно:

   1. Необходимо упаковать приложение в чарт для деплоя в разные окружения.
   2. База данных должна быть отказоустойчивой. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии.
   3. Кеш должен быть отказоустойчивый. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии.
   4. Фронтенд обрабатывает внешние запросы быстро, отдавая статику. Потребляет не более 50 МБ ОЗУ на каждый экземпляр, 0.2 ядра. 5 копий.
   5. Бекенд потребляет 600 МБ ОЗУ и по 1 ядру на копию. 10 копий.

### Расчет 
1. Подсчитаем суммарное количество ресурсов
   
```
Единицы измерения Гигабайты, мегабайты. Т.е. 1ГБ = 1000МБ.(международная система единиц)

    БД:       4Гб * 3, 1CPU * 3 :     12000 МБ,   3 CPU
    КЕШ:      4Гб * 3, 1CPU * 3 :     12000 МБ,   3 CPU
    Фронтенд: 50 МБ * 5, 0.2 CPU * 5: 250 МБ,  1 CPU
    Бекенд:   600 МБ * 10, 1 CPU * 10: 6000 МБ, 10 CPU
    ---------------
    Итого:   30250 МБ, 17 CPU
```
2. Отказоустойчивость

```
  Разделим проект на 2 пула контейнеров.
1. Для обеспечения отказоустойчивости базы данных + кеш.
2. Для микросервисов.

```

3. Расчет рабочих нод для пула БД

```
Советуют расчитывать количество контейнеров на ноду как квадратный корень из общего числа контейнеров.
(при оценке дом.задания напишите мне в ответ, допустимо ли такое )) )

* Для размещения 6 контейнеров возьмем 3 ноды, по 2 контейнера на ноду.

* Закладываемся в то, что в один момент времени может упасть 1 нода.

* Запас ресурсов = 2 контейнера * (1 CPU + 4GB)/2 оставшиеся после аварии ноды = 1 CPU + 4 GB 

* Ресурсы ноды = 2 контейнера * (1 CPU + 4GB) + (1 CPU + 4 GB) запас ресурсов = 3 СPU + 12 GB

* Оценим с учетом выделения CPU служебным ресурсам:
  3 CPU - 0.075 CPU(6% от первого ядра, 1% от второго ядра, 0.5% от третьего) = 2.925 CPU.
  С учетом требований работы хотя бы 2-х нод, доступно будет только 5,85 CPU из требуемых 6 CPU. Этого не хватит.
  Поэтому берем ресурсы 1-ой ноды: 4 CPU 

  12 GB - 2,2 GB(25% от первых 4 ГБ = 1ГБ, 20 % от след. 4 ГБ = 0,8ГБ, 10% от отсавшихся 4 ГБ = 0.4ГБ ) = 9,8 GB доступной памяти,
  чего не хватит на работу в 2 нодах, так как будет только 19,6 GB из требуемых 24 GB.
  Поэтому берем памяти: 16 GB.

```

4. Расчет рабочих нод для пула  микросервисов.
```
 * Для размешения 15 контейнеров берем 5 нод, по 3 контейнера на каждом

 * Закладываемся в то, что в один момент времени может упасть 1 нода.

 * Запас ресурсов = 3 контейнера * (1,2 CPU + 0,65 GB)/4 оставшиеся после аварии ноды ~ 1 CPU + 0,5 GB

 * Ресурсы ноды = 3 контейнера *(1,2 CPU + 0,65 GB) + 1 CPU + 0,5 GB ~ 4 CPU + 3 GB

 * Оценим с учетом выделения CPU служебным ресурсам:
   4 CPU - 0.08(6% от первого ядра, 1% от второго ядра, по 0.5% от третьего и четвертого) = 3,92 CPU
   С учетом требований работы хотя бы 4-х нод, доступно будет 15,68 CPU, что перекрывает требования. Достаточно было бы и 3 CPU.

   3GB - 0,75GB(25% от первых 3 ГБ)=2,25GB доступной памяти.
   С учетом требований работы хотя бы 4-х нод, доступно будет 9 GB, что перекрывает требования c запасом.

```
5. Итоги
   
     * 3 мастер ноды с 2 ядрами и 4 ГБ ОЗУ.
   
     * 3 рабочих ноды с 4 ядрами и 16 ГБ ОЗУ для БД и КЕШ
   
     * 5 рабочих нод с 3 CPU и 3 ГБ ОЗУ для фронтенд и бекенд.(+- доступные варианты от например поставщика виртуальных машин)

   Остается возможность еще для масштабирования(увеличения количества метрик), запас есть.

   Решил выбрать вариант с 2 пулами...Если посчитать все в одну кучу, м.б было бы дешевле...По аналогичному расчету все можно проверить ;)
   
```

