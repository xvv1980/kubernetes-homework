## Домашнее задание к занятию «Хранение в K8s. Часть 2»

### Задание 1
Создать Deployment приложения, использующего локальный PV, созданный вручную.

 - Создать Deployment приложения, состоящего из контейнеров busybox и multitool.

   [deployment манифест](deploy-1.yaml)
   
 - Создать PV и PVC для подключения папки на локальной ноде, которая будет использована в поде.

   [PersistentVolume манифест](pv.yaml)

   [PersistentVolumeClame манифест](pvc.yaml)

 - Продемонстрировать, что multitool может читать файл, в который busybox пишет каждые пять секунд в общей директории.

   ![изображение](https://github.com/user-attachments/assets/0e37528f-621d-41a4-860e-18c7f2cb5746)


 - Удалить Deployment и PVC. Продемонстрировать, что после этого произошло с PV. Пояснить, почему.

   Перед удалением смотрим, что на ноде создан каталог c файлом /tmp/pv/output.txt согласно манифеста  [PersistentVolume манифест](pv.yaml) и туда пишутся данные.

   ![изображение](https://github.com/user-attachments/assets/35803847-6462-4f40-97c4-8489da4e4939)

   Удаляем Deployment и PVC

   ![изображение](https://github.com/user-attachments/assets/7d9c98c7-a5f9-44c0-b5f9-f805a57d2e87)

   Видим, что при удалении pvc удалился и pv. А также была удален соответственно и каталог /tmp/pv вместе с содержимым.

   ![изображение](https://github.com/user-attachments/assets/a4a7f071-59db-43b5-8fce-fd59764635c2)

   Это получилось из-за того, что persistentVolumeReclaimPolicy: Delete  работает с каталогом находящимся в /tmp/*. Поэтому при удалении pvc все удалилось автоматом. Если бы я указал каталог для volume в любом другом месте, то при удалении pvc, pv бы не удалился. Тогда пришлось бы его удалять вручную.
    
 - Продемонстрировать, что файл сохранился на локальном диске ноды. Удалить PV. Продемонстрировать что произошло с файлом после удаления PV. Пояснить, почему.

    ВНИМАНИЕ: смотри пояснения выше.

   ### Задание 2
   Создать Deployment приложения, которое может хранить файлы на NFS с динамическим созданием PV.

    - Включить и настроить NFS-сервер на MicroK8S.

      На моей тестовой node был поднят addon nfs MicroK8S.

      ![изображение](https://github.com/user-attachments/assets/09b3dcf9-8082-4925-875d-5685534d6f3a)

     Это дополнение поднимает сервер NFS Ganesha Server и Provisioner в MicroK8s, работающие как pod. Компоненты будут установлены и подключены друг к другу. В отличие от стандартного пути к хосту-хранилищу, это дополнение может предоставлять хранилище любому узлу, входящему в состав кластера.
     При установке дополнения создается StorageClass = nfs. Это имя мы будем использовать при описании pvc.

    - Создать Deployment приложения состоящего из multitool, и подключить к нему PV, созданный автоматически на сервере NFS.

      [deployment манифест](deploy-2.yaml)
      
      [PersistentVolumeClame манифест](pvc-nfs.yaml)
    
    - Продемонстрировать возможность чтения и записи файла изнутри пода.

      Поднимаем наш pvc, создается атоматически pv
      
      ![изображение](https://github.com/user-attachments/assets/14105092-d657-4f22-8e35-7892220f17b0)

      Поднимаем pod и создаем файл в общем volume

      ![изображение](https://github.com/user-attachments/assets/1222a3d2-008f-4a12-90ef-75d65f66e89c)

      Проверяем на node nfs каталог и видим что файл с содержимым на месте
      
      ![изображение](https://github.com/user-attachments/assets/67c9225a-5397-4810-858d-ba5f6c97a430)



